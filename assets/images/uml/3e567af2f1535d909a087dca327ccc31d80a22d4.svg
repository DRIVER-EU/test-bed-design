<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="798px" preserveAspectRatio="none" style="width:743px;height:798px;" version="1.1" viewBox="0 0 743 798" width="743px" zoomAndPan="magnify"><defs><filter height="300%" id="f1sx7c0pfjkbkd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="336" x="200" y="24.5332">OIDC-based Web SSO (Authorization Code Flow)</text><rect fill="#DDDDDD" height="646.8203" style="stroke: #A80036; stroke-width: 1.0;" width="491" x="241" y="35.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="459.5" y="49.1045">Test-bed</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="42" x2="42" y1="110.1797" y2="625.2109"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="287" x2="287" y1="110.1797" y2="625.2109"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="470" x2="470" y1="110.1797" y2="625.2109"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="667" x2="667" y1="110.1797" y2="625.2109"/><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="8" y="73.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="15" y="95.1035">Browser</text><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="8" y="624.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="15" y="645.7441">Browser</text><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="245" y="55.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="274.5" y="77.4941">IDP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="252" y="95.1035">(Keycloak)</text><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="245" y="624.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="274.5" y="645.7441">IDP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="252" y="663.3535">(Keycloak)</text><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="411" y="55.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="422.5" y="77.4941">Reverse Proxy</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="418" y="95.1035">(SSL+OIDC RP)</text><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="411" y="624.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="422.5" y="645.7441">Reverse Proxy</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="418" y="663.3535">(SSL+OIDC RP)</text><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="611" y="69.5703"/><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="607" y="73.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="614" y="95.1035">Webapp Server</text><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="611" y="624.2109"/><rect fill="#FEFECE" filter="url(#f1sx7c0pfjkbkd)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="607" y="628.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="614" y="649.7441">Webapp Server</text><polygon fill="#A80036" points="458.5,138.5313,468.5,142.5313,458.5,146.5313,462.5,142.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42.5" x2="464.5" y1="142.5313" y2="142.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="49.5" y="137.6748">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="60.5" y="137.6748">app request</text><polygon fill="#A80036" points="53.5,168.8828,43.5,172.8828,53.5,176.8828,49.5,172.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="469.5" y1="172.8828" y2="172.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="168.0264">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="70.5" y="168.0264">redirect to IDP (invalid cookie)</text><polygon fill="#A80036" points="53.5,199.2344,43.5,203.2344,53.5,207.2344,49.5,203.2344" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="275.5,199.2344,285.5,203.2344,275.5,207.2344,279.5,203.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="281.5" y1="203.2344" y2="203.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="198.3779">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="70.5" y="198.3779">authentication</text><polygon fill="#A80036" points="53.5,229.5859,43.5,233.5859,53.5,237.5859,49.5,233.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="286.5" y1="233.5859" y2="233.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="59.5" y="228.7295">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="70.5" y="228.7295">redirect back to app with authz code</text><polygon fill="#A80036" points="458.5,276.2891,468.5,280.2891,458.5,284.2891,462.5,280.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42.5" x2="464.5" y1="280.2891" y2="280.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="49.5" y="267.2568">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="60.5" y="259.0811">app login request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="60.5" y="275.4326">+ authz code</text><polygon fill="#A80036" points="298.5,322.9922,288.5,326.9922,298.5,330.9922,294.5,326.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="292.5" x2="469.5" y1="326.9922" y2="326.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="304.5" y="313.96">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="315.5" y="305.7842">OIDC token request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="315.5" y="322.1357">+ authz code</text><polygon fill="#A80036" points="458.5,353.3438,468.5,357.3438,458.5,361.3438,462.5,357.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287.5" x2="464.5" y1="357.3438" y2="357.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="294.5" y="352.4873">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="305.5" y="352.4873">OIDC token incl. user info</text><polygon fill="#0000FF" points="655.5,400.0469,665.5,404.0469,655.5,408.0469,659.5,404.0469" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="470.5" x2="661.5" y1="404.0469" y2="404.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="477.5" y="391.0146">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="488.5" y="382.8389">app login request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="488.5" y="399.1904">+ authn headers (user info)</text><polygon fill="#0000FF" points="481.5,446.75,471.5,450.75,481.5,454.75,477.5,450.75" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="475.5" x2="666.5" y1="450.75" y2="450.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="487.5" y="437.7178">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="498.5" y="429.542">app response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="498.5" y="445.8936">+ Set-Cookie (app cookie)</text><polygon fill="#A80036" points="53.5,493.4531,43.5,497.4531,53.5,501.4531,49.5,497.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47.5" x2="469.5" y1="497.4531" y2="497.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="59.5" y="484.4209">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="77.5" y="476.2451">app response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="77.5" y="492.5967">+ Set-Cookie (app &amp; RP cookies)</text><polygon fill="#A80036" points="458.5,540.1563,468.5,544.1563,458.5,548.1563,462.5,544.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42.5" x2="464.5" y1="544.1563" y2="544.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="49.5" y="531.124">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="67.5" y="522.9482">app request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="67.5" y="539.2998">+ app &amp; RP cookies</text><polygon fill="#0000FF" points="655.5,603.2109,665.5,607.2109,655.5,611.2109,659.5,607.2109" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="470.5" x2="661.5" y1="607.2109" y2="607.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="477.5" y="586.0029">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="495.5" y="569.6514">app request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="495.5" y="586.0029">+ app cookie</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="495.5" y="602.3545">+ authn headers (user info)</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="50" x="3" y="696.8105">Red arrow:</text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="56" y="696.8105">HTTPS</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="128" x="3" y="709.3887">Blue arrow: HTTP (no SSL)</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="110" x="3" y="721.9668">OIDC: OpenID Connect</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="246" x="3" y="734.5449">IDP: Identity Provider, aka OpenID Connect Provider</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="257" x="3" y="747.123">RP: (OpenID Connect) Relying Party, aka OAuth Client</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="97" x="3" y="759.7012">App: Webapp Server</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="102" x="3" y="772.2793">authn: authentication</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="94" x="3" y="784.8574">authz: authorization</text><!--
@startuml
left footer
Red arrow: **HTTPS**
Blue arrow: HTTP (no SSL)
OIDC: OpenID Connect
IDP: Identity Provider, aka OpenID Connect Provider
RP: (OpenID Connect) Relying Party, aka OAuth Client
App: Webapp Server
authn: authentication
authz: authorization
endfooter

title OIDC-based Web SSO (Authorization Code Flow)

autonumber
participant Browser as B
box "Test-bed"
  participant "IDP\n(Keycloak)" as IDP
  participant "Reverse Proxy\n(SSL+OIDC RP)" as RP
  collections "Webapp Server" as App
end box

B -> RP: app request
B <- RP: redirect to IDP (invalid cookie)
B <-> IDP: authentication
B <- IDP: redirect back to app with authz code
B -> RP: app login request\n+ authz code
RP -> IDP: OIDC token request\n+ authz code
RP <- IDP: OIDC token incl. user info
RP -[#blue]> App: app login request\n+ authn headers (user info)
RP <[#blue]- App: app response\n+ Set-Cookie (app cookie)
B <- RP: app response\n+ Set-Cookie (app & RP cookies)
B -> RP: app request\n+ app & RP cookies
RP -[#blue]> App: app request\n+ app cookie\n+ authn headers (user info)
@enduml

PlantUML version 1.2018.14(Fri Dec 21 17:33:16 CET 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_221-b11
Operating System: Windows 10
OS Version: 10.0
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>